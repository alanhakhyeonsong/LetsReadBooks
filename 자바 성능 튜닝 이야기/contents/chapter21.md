# Story 21. 반드시 튜닝 해야 하는 대상은?
일반적으로 기능 테스트, 성능 테스트, 부하 테스트, 보안 테스트 등 여러 가지 테스트를 수행하는데 이러한 테스트를 수행할 땐 튜닝까진 아니더라도 **구간별 응답 속도를 체크하는 작업은 필요**하다.

## 반드시 튜닝해야 하는 대상 선정
현실적으로 개발자가 모든 화면에 대해 분석하는 것은 불가능하다. APM 툴이 있다면 그 툴을 사용해 전체 프로그램을 분석하면 되겠지만, 그렇지 않은 상황일 때도 있다.

파레토 법칙은 개발하고 유지보수하는 시스템에도 적용된다. 전체 80%의 사용량을 점유하는 20%의 화면을 어떻게 찾을까? 모니터링 툴이 없다면, 웹 로그를 분석할 수도 있다. 새로운 시스템을 만들 경우엔, 고객에게 예상되는 화면을 선정해달라 요청하자.

- 검색 버튼 클릭 후 잘못된 입력으로 인한 DB의 CPU 대부분을 점유하는 케이스
- 하나의 화면 때문에 시스템이 다운되는 케이스
  - 문제로 추정되는 화면용 인스턴스를 별도로 분리해서 추적해본다.
  - 호출 되는 화면의 응답 속도, 검색 시 DB 쿼리 수행 시간 대 애플리케이션 수행 시간의 비율을 추적해본다.
  - 해당 화면 내에서 DB의 쿼리 수를 추적해본다.

## 왜 로그인 화면을 튜닝(분석)해야 하는가?
그룹웨어 시스템을 예시로 들어보자.

|구분|화면명|
|--|--|
|로그인|로그인 화면 및 초기 화면|
|메일|메일 목록 및 상세 조회, 메일 작성 및 발송|
|게시|게시물 목록 및 상세 조회|
|결재|결재 목록 및 상세 조회, 결재 작성 및 상신, 결재 수행|
|임직원 조회|임직원 조회 및 상세 조회|
|커뮤니티|커뮤니티 초기 화면, 게시물 목록 및 상세 조회, 게시물 작성|
|메신저|사용자 목록, 메시지 전송 및 수신|

그룹웨어의 사용자가 가장 집중되는 시간은 오전 출근 시간대와 오후 중식 이후 시간대일 것이다. 이 시간대에 로그인이 안되면 메일, 게시, 결재 등 중요한 업무를 처리할 기회 조차 없다. 적어도 위에 명시된 기능들은 정상적으로 수행되어야 한다.

대부분의 시스템에서 로그인한 후의 화면은 여러 개의 포틀릿으로 구성되어 있을 것이다. 초기 화면에서, 로그인 시 몇 번의 요청을 수행하는지 체크했더니 다음과 같았다고 한다.

|컴포넌트 명|개수|
|--|--|
|로그인 프로세스 관련|2개|
|포틀릿 관련|20개|
|SSO 등 컴포넌트 관련|5개|
|기타|19개|

시스템을 운영하고 있다면, 가장 많이 사용하는 로그인 화면이 얼마나 많은 요청을 수행하는지, 필요 없는 요청이 있는지 확인해보자.

## 쇼핑몰 사이트에서는...
쇼핑몰에서 일반적인 고객이 주로 사용하는 화면의 목록은 다음과 같다.

|구분|화면명|
|--|--|
|메인 화면|초기 화면, 대분류 선택, 중분류 선택, 소분류 선택|
|검색|상품 검색, 상품 상세 조회|
|전자 결제|로그인 및 즉시 결제 선택, 구매자 상세 정보 입력, 전자 결제 수행|
|My Page|구매한 상품 목록|
|이벤트|이벤트 조회|

일반적으로 소비자는 원하는 물건을 구매할 때 쇼핑몰이나 가격 비교 사이트를 통해 상품을 조회하고, 제품의 상세 정보를 조회한다. 쇼핑몰이나 가격 비교 사이트의 초기 페이지가 열리지 않거나, 제품의 상세 정보 조회가 되지 않으면 해당 사이트는 많은 고객을 잃는다. 제품을 구매하기로 결정한 소비자가 결제 수행을 할 수 없을 때도 동일한 결과가 발생한다.

JSP 기반으로 프로그램을 작성했다면, `System.exit(int)` 메서드는 절대 사용하면 안된다. 우리가 기동한 WAS 인스턴스가 소리 소문 없이 사라질 것이다. 왜냐하면 이 메서드는 현재 수행 중인 JVM을 종료하는 메서드이기 때문이다.