# 3장. 네트워크 통신하기

## 1. 유니캐스트, 멀티캐스트, 브로드캐스트, 애니캐스트

네트워크에서 출발지에서 목적지로 데이터를 전송할 때 사용하는 통신 방식은 다음과 같다.

### 유니캐스트(Unicast)

![](https://images.velog.io/images/songs4805/post/d50f9817-bd93-49c9-96dd-c314b0c21524/image.png)

- 1:1 통신
- 출발지와 목적지가 1:1로 통신
- 대부분의 통신은 유니캐스트 방식을 사용함

### 브로드캐스트(Broadcast)

![](https://images.velog.io/images/songs4805/post/8f1ec26c-21b5-42a4-897d-422460ad7e3e/image.png)

- 1:모든 통신
- 동일 네트워크에 존재하는 모든 호스트가 목적지
- 유니캐스트로 통신하기 전, 주로 상대방의 정확한 위치를 알기 위해 사용된다.
- 기본 동작은 로컬 내트워크 내에서 모든 호스트에 패킷을 전달해야 할 때 사용된다.

### 멀티캐스트(Multicast)

![](https://images.velog.io/images/songs4805/post/8c11f905-003c-4a80-9c0c-c7f8239bd329/image.png)

- 1:그룹(멀티캐스트 구독 호스트) 통신
- 하나의 출발지에서 다수의 특정 목적지로 데이터 전송
- IPTV와 같은 실시간 방송을 볼 때 이 멀티캐스트 통신 방식을 사용한다.
- 사내방송이나 증권 시세 전송과 같이 단방향으로 다수에게 동시에 같은 내용을 전달할 때 사용됨

### 애니캐스트(Anycast)

![](https://images.velog.io/images/songs4805/post/d686bc02-5674-4a49-96d4-7cfc12849197/image.png)

- 1:1 통신(목적지는 동일 그룹 내의 1개 호스트)
- 다수의 동일 그룹 중 가장 가까운 호스트에서 응답
- IPv4에서는 일부 기능 구현, IPv6은 모두 구현 가능
- 애니캐스트 주소가 같은 호스트들 중 가장 가깝거나 가장 효율적으로 서비스할 수 있는 호스트와 통신하는 방식.  
  → 애니캐스트 게이트웨이의 성질을 이용해 가장 가까운 DNS 서버를 찾을 때 사용
- 최종 통신은 1:1로 유니캐스트와 애니캐스트가 동일하지만 통신 대상 후보자는 서로 다르다.
  - 유니캐스트는 출발지와 목적지가 모두 한 대씩이다.
  - 애니캐스트는 같은 목적지 주소를 가진 서버가 어러대여서 통신 가능한 다수의 후보군이 있다.

### 정리

- 현재 주로 사용되는 네트워크 주소체계는 IPv4 기반이다.
- 일부 모바일 네트워크 및 대규모 데이터 센터 위주로 새로운 IPv6 기반 주소 체계가 사용되고 있다.
- IPv6에서는 브로드캐스트가 존재하지 않고 링크 로컬 멀티캐스트로 대체되어 사용된다.

| 타입         | 통신 대상  | 범위                  | IPv4 | IPv6 | 예제       |
| ------------ | ---------- | --------------------- | ---- | ---- | ---------- |
| 유니캐스트   | 1:1        | 전체 네트워크         | o    | o    | HTTP       |
| 브로드캐스트 | 1:N(ALL)   | 서브넷(로컬 네트워크) | o    | x    | ARP        |
| 멀티캐스트   | 1:N(Group) | 정의된 구간           | o    | o    | 방송       |
| 애니캐스트   | 1:1        | 전체 네트워크         | △    | o    | 6 to 4 DNS |

## 2. MAC 주소

MAC(Media Access Control)은 2계층(데이터 링크 계층)에서 통신을 위해 네트워크 인터페이스에 할당된 고유 식별자이다. MAC 주소는 이더넷과 와이파이를 포함한 대부분의 IEEE 802 네트워크 기술에서 2계층 주소로 사용된다. 네트워크에 접속하는 모든 장비는 MAC 주소라는 물리적인 주소가 있어야 하고 이 주소를 이용해 서로 통신하게 된다.

### MAC 주소 체계

- 주소를 변경할 수 없도록 하드웨어에 고정되어 있다.
- 제조업체마다 하나 이상의 주소풀을 주고 각 제조업체는 이 주소풀 안에서 자체적으로 MAC 주소를 할당한다.
  - 네트워크 장비 제조업체에서 주소풀을 할당하는 것을 제조사 코드(Vender Code)라 하며 국제기구인 IEEE에서 관리한다.
- 48비트의 16진수 12자리로 표현되며, 앞의 24비트와 뒤의 24비트로 나눠 구분한다.
  - 앞의 24비트가 IEEE가 제조사에 할당하는 제조사 코드이다.
  - 뒤의 24비트는 각 제조사에서 자체적으로 할당하는 부분이다.

![](https://images.velog.io/images/songs4805/post/f200058f-3d9d-4fcb-a443-937def1bd9ea/image.png)

- 네트워크 카드(혹은 장비)를 생산할 때 하드웨어적으로 정해져 나오므로 MAC 주소를 BIA(Burned-In Address)라고도 부른다.

> 📌 참고 - 유일하지 않은 MAC 주소
>
> 언제나 예외는 있듯 MAC 주소도 유일하지 않을 수 있다. 제조업체는 자신의 제조업체 코드 내에서 뒤의 24비트의 UAA 값을 할당하는데 실수나 의도적으로 MAC 주소가 중복될 수 있다. 이러한 MAC 주소는 동일 네트워크에서만 중복되지 않으면 동작하는데 문제가 없다.
>
> 만약 다른 네트워크와 통신을 해야해서 라우터의 도움을 받아야 한다면 출발지와 목적지의 MAC 주소가 변경되기에 네트워크를 넘어가면 기존 출발지와 도착지의 MAC 주소를 유지하지 않는다.

### MAC 주소 동작

- NIC는 MAC 주소를 가지고 있다.
- NIC는 전기 신호가 들어오면 2계층에서 데이터 형태(패킷)로 변환하여 내용을 구분한 뒤 도착지 MAC 주소를 확인한다.
- 만약 도착지 MAC 주소가 자신이 갖고 있는 MAC 주소와 다를 경우 패킷을 폐기한다.
- MAC 주소가 같거나 브로드캐스트, 멀티캐스트와 같은 그룹 주소일 경우 처리해야 할 주소로 인지해 패킷정보를 상위 계층으로 넘겨준다.

![](https://images.velog.io/images/songs4805/post/929d83ed-36f8-41b8-9b0c-c35700991343/image.png)

- 본인의 주소, 브로드캐스트 주소는 NIC 자체적으로 패킷을 처리하는 것이 아니라 OS나 애플리케이션에서 처리해야 하기 때문에 시스템 부하가 작용한다.
- 브로드캐스트 스톰의 경우, 브로드캐스트가 회선을 모두 채우게 되는데 네트워크에 연결된 모든 단말이 브로드캐스트를 처리하느라 CPU 사용량이 증가한다.

> 📌 참고 - 무차별 모드(Promiscuous Mode)
>
> NIC는 불필요한 패킷(자신의 MAC 주소와 일치하지 않는 도착지 주소를 가진 패킷)을 폐기하기 때문에디버그 및 분석 용도나 모니터링 용도로 전체 패킷을 수집해야 할 경우 NIC가 정상동작을 하면 다른 목적지를 가진 패킷을 분석할 수 없다.
>
> 만약 다른 목적지를 가진 패킷도 분석 및 수집이 필요하다면 무차별 모드로 NIC를 구성하면 된다. 무차별 모드는 자신의 MAC 주소와 상관없는 패킷이 들어와도 이를 분석할 수 있도록 메모리에 올려 처리할 수 있도록 한다.

## 3. IP 주소

OSI 7계층에서 주소를 갖는 계층은 물리 주소인 MAC 주소를 사용하는 2계층과 논리 주소인 IP 주소를 사용하는 3계층이 있다. 대부분의 네트워크가 TCP/IP로 동작하므로 IP 주소 체계를 이해하는 것이 네트워크 이해에 매우 중요하다.

- 사용자가 변경 가능한 논리 주소이다.
- 주소에 레벨이 있으며 그룹을 의미하는 네트워크 주소와 호스트 주소로 나뉜다.

### IP 주소 체계

IP 주소는 우리가 흔히 사용하는 IPv4(32bit)와 IPv6(128bit)가 있다.  
IPv4 주소는 다음과 같이 표기한다.

![](https://images.velog.io/images/songs4805/post/ac73fe04-2761-47da-986d-f90891a9fe21/image.png)

**4개의 옥텟(Octet)이라 불리는 8bit 단위로 나누고**, **각 옥텟은 `.`로 구분**한다. 2계층의 MAC 주소가 16진수로 표기된 것과는 달리 **IP주소는 10진수로 표기하므로 8bit의 옥텟은 0~255의 값을 쓸 수 있다.**

**특징**

- **네트워크 주소**와 **호스트 주소** 두 부분으로 나뉜다.
  - 네트워크 주소: 호스트들을 모은 네트워크를 지칭하는 주소로 해당 주소가 동일한 네트워크를 로컬 네트워크라 한다.
  - 호스트 주소: 하나의 네트워크 내에 존재하는 호스트를 구분하기 위한 주소
- 네트워크 주소와 호스트 주소를 구분하는 경계점이 고정되어 있지 않다.
- 필요한 호스트 IP 갯수에 따라 네트워크의 크기를 다르게 할당할 수 있는 **클래스 개념**을 도입했다.
- 클래스는 옥텟을 구분자로 사용하는데 이 구분자를 서브넷 마스크라 한다.
- 현재는 이런 클래스 기반을 잘 사용하지 않는다.  
  → 더 세밀하게 분할 및 할당을 위해 필요 네트워크 크기에 맞춰 1비트 단위로 네트워크를 상세히 분할하는 방법을 사용

### IP 주소 클래스(A, B, C class)

- IP 주소를 네트워크 주소와 호스트 주소로 구분하는 방법
- 하나의 네트워크에서 몇 개의 호스트 주소를 가질 수 있느냐에 따라 클래스를 나눌 수 있다.
- **IP 주소가 도입한 클래스 개념은 다른 고정된 네트워크 주소 체계에 비해 주소를 절약할 수 있다는 장점이 있다.**
- 대규모 네트워크가 늘어나는 상황에서 한정된 자원인 IP 주소를 체계적으로 나눠 쓸 필요가 있다.

![](https://images.velog.io/images/songs4805/post/b6f46e24-a570-49a4-b87f-7ed62a8d64a9/image.png)

![](https://images.velog.io/images/songs4805/post/17b46921-038f-48c3-bd1b-078361739075/image.png)

**Class A**

- 하나의 네트워크가 가질 수 있는 호스트 수가 가장 많은 클래스
- IP 주소를 바이너리로 표시할 때 맨 앞자리수가 항상 0인 경우

`0xxx xxxx. xxxx xxxx. xxxx xxxx. xxxx xxxx`

- `0.0.0.0` ~ `126.255.255.255` 까지를 A 클래스라 한다.
- 네트워크 주소를 표현하는 부분이 1개의 옥텟, 호스트 주소를 나타내는 부분이 3개의 옥텟이다.
- 네트워크 주소는 `1.0.0.0`과 `126.0.0.0`까지로 규정되어 있다.
- 한 네트워크 당 2^24(약 1600만)개의 호스트 주소를 갖게 된다.

**Class B**

- IP 주소를 바이너리로 표시할 때 맨 앞자리수가 항상 10인 경우

`10xx xxxx. xxxx xxxx. xxxx xxxx. xxxx xxxx`

- `128.0.0.0` ~ `191.0.0.0` 까지를 B 클래스라 한다.
- 네트워크 주소 부분이 2개의 옥텟, 호스트 주소가 2개의 옥텟이다.
- 네트워크 주소는 2^14개, 호스트 주소는 2^16개 이다.

**Class C**

- IP 주소를 바이너리로 표시할 때 맨 앞자리수가 항상 110으로 시작한다.

`110x xxxx. xxxx xxxx. xxxx xxxx. xxxx xxxx`

- `192.0.0.0` ~ `223.0.0.0` 까지를 C 클래스라 한다.
- 2^24개의 네트워크와 1개의 네트워크 당 2^8개의 호스트 주소를 가질 수 있다.

// **IP 체계에서 맨 앞의 숫자를 네트워크 주소로, 맨 뒤의 숫자를 브로드캐스트 주소로 사용하므로 실제 사용할 수 있는 IP는 각 클래스당 2개 씩 줄여야 한다.** (ex) A 클래스: 2^24 - 2)

### 클래스풀과 클래스리스

클래스 기반의 IP주소 체계를 클래스풀(Classful)이라 하는데, IP 주소 체계 등장 초기에는 확장성과 비용절약 등에 있어 좋은 방법이었다. 이 주소 체계에서는 네트워크 주소와 호스트 주소를 구분짓는 서브넷 마스크도 필요없었다. 맨 앞자리 숫자만 봐도 클래스 구분이 가능했기에 주소 구분자를 사용할 수 있었다.

**클래스리스 네트워크의 등장**  
시간이 지남에 따라 클래스풀 기반 주소 체계로도 감당이 힘든 시기가 왔다. 이론적으로 IPv4에서 사용 가능한 IP의 개수는 대략 43억개 이지만 실제 사용가능한 IP 개수는 이보다 훨씬 적을 것이고 그 숫자는 인구가 하나씩 가질수도 없는 숫자이다.

그래서 이런 문제를 해결하기 위해 3가지 보존, 전환 전략을 만들었다.

- **클래스리스, CIDR(Classless Inter-Domain Routing) 기반의 주소 체계**
- **NAT와 사설 IP 주소**
- **차세대 IP인 IPv6**

IPv4에서 주소 자체가 부족하다는 문제도 있지만, 그 외에도 상위 클래스(A Class)를 할당 받은 조직에서 대부분 제대로 사용을 못하고 낭비되는 것도 문제이다. 수천만개의 IP를 사용할 수 있는 A클래스를 할당 받아도 그 중 많아야 수만개 정도에서 끝나면 나머지는 다 낭비되며 다른 조직이나 기관에서 사용할수도 없다.

**이러한 문제를 해결하기 위해 클래스라는 개념을 버리게되고 이를 클래스리스라 부른다.**

현재 우리가 사용하는 주소 체계는 클래스 개념을 적용하지 않는 클래스리스 기반 주소 체계이다. 클래스리스 네트워크에서는 별도로 네트워크와 호스트 주소를 나누는 구분자를 사용해야 하는데 이를 **서브넷 마스크(Subnet Mask)** 라 부른다.

이러한 서브넷 마스크는 IP 주소와 네트워크 주소를 구분할 때 사용하며 다음과 같이 표시한다.

- 2진수 숫자 1: 네트워크 주소
- 2진수 숫자 0: 호스트 주소

이를 10진수로 사용하면 `255.0.0.0`, `255.255.0.0`, `255.255.255.0`와 같이 표현할 수 있다.

예시로, `103.9.32.146`이라는 주소는 해당 주소가 `255.255.255.0` 서브넷 마스크를 사용하는 IP 라면 서브넷 마스크와 AND 연산을 통해 네트워크 주소와 호스트 주소를 알아낼 수 있다.

![](https://images.velog.io/images/songs4805/post/69717095-a885-4ba9-abac-49434d5ed551/image.png)

결과는 위 표와 같이 네트워크 주소는 `103.9.32.0`이 되고 호스트 주소는 `0.0.0.146`이 된다.  
클래스리스 기반의 IP 네트워크에서는 네트워크 표현에 있어 서브넷 마스크가 필수이다.

> 📌 참고: 비트 단위로 서브넷 마스크를 표현하는 방법
>
> 서브넷 마스크에서 **1 부분이 연속된 자릿수를 표현해주는 것**이다. **A 클래스를 서브넷 마스크로 나타내면 첫 번째 옥텟이 1, 나머지 옥텟이 0이므로 `/8`로 표현**한다. **B 클래스는 `/16`, C 클래스는 `/24`로 표기**한다.

### 서브네팅(Subnetting)

원래 부여된 클래스의 기준을 무시하고 새로운 네트워크-호스트 구분 기준을 사용자가 정해 **원래 클래스풀 단위의 네트워크보다 더 쪼개 사용하는 것**을 서브네팅이라 한다.

부여된 주소를 다시 잘라 사용해 서브네팅이라 하며 현대 클래스리스 네트워크의 가장 큰 특징이다.  
이 서브네팅을 이해하기 어려운 이유는 실제 옥텟 단위보다 더 잘게 네트워크를 쪼개 2진수의 1비트 단위로 네트워크를 분할하기 때문이다.

![](https://images.velog.io/images/songs4805/post/82e0f560-4008-4da7-807e-b8b39e7cf01a/image.png)

실무에서 이런 서브네팅을 언제 고민해야하는 걸까?

- 네트워크 디자인 단계에서 네트워크 설계자가 네트워크를 효율적으로 어떻게 분할할 것인지 계획하는 경우
- 이미 분할된 네트워크에서 사용자가 자신의 네트워크와 원격지 네트워크를 구분해야 하는 경우

즉, 네트워크 사용자 혹은 설계자 입장에 따라 고려할 요소와 범위가 달라진다.

- 네트워크 사용자 입장
  - 네트워크에서 사용할 수 있는 IP 범위 파악
  - 기본 게이트웨이와 서브넷 마스크 설정이 제대로 되어 있는지 확인
- 네트워크 설계자 입장
  - 네트워크 설계 시 네트워크 내에 필요한 단말을 고려한 네트워크 범위 설계

// 분량 상 자세한 내용은 책을 참고하자.

### 공인 IP와 사설 IP

- 공인 IP: 전 세계에서 유일해야 하는 식별자
- 사설 IP: 개인적으로 구성되어 IP 주소를 할당받지 않고 구축되어 사용되는 식별자

실제 인터넷에 접속하기 위해서는 공인 IP 주소가 필요하다.  
하지만, 공인 IP는 통신사업자로부터 할당받거나 IP 할당기관에서 인터넷 독립기관 주소를 할당받은 후 독립 IP를 할당받아야 하기 때문에 그 과정이 복잡하다.

인터넷에 접속하지 않거나 NAT(Network Address Translaction, 네트워크 주소 변환) 기술을 사용한다면 사설 IP 주소를 사용할 수 있다.

이러한 사설 IP 주소를 사용하면 인터넷에 직접 접속하진 못하지만 IP를 변환해주는 NAT 장비에서 공인 IP로 변경한 후에는 인터넷 접속이 가능하다. 가정에서 많이 사용하는 공유기는 NAT 장비 역할을 하는 대표적인 예이다.

사설 네트워크 구축 시 주의점이 있는데, NAT를 사용해서 인터넷에 접속하더라도 다른 사용자에게 할당된 IP를 사설 네트워크 주소로 사용해서는 안된다. 그 이유는 다른 인터넷 연결에는 문제가 없지만, 내부 네트워크의 할당된 IP를 공식으로 사용하는 네트워크로 접속할 수 없기 때문이며 그 때문에 어느 인터넷 구간에서도 사용되지 않는 RFC에 명시된 사설 IP 대역을 사용할 것을 추천한다.

![](https://images.velog.io/images/songs4805/post/0edb58d9-93e3-4379-8458-a64e305b11d3/image.png)

> C회사에서 A회사로 접속을 시도할 경우 C회사 서버는 A회사의 서버가 같은 네트워크에 존재한다고 판단하여 A회사 서버인 20.0.0.20과 통신하기 위해 브로드캐스트한다. 실제로는 인터넷 구간을 거쳐서 원격지와 통신 시도를 서로 인식해야 하지만, 같은 네트워크로 판단하기에 정상적인 통신이 불가능하다.
