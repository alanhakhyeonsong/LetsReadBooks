# 1장. 네트워크 시작하기

## 1. 네트워크 구성도 살펴보기

네트워크는 크게 서비스를 받는 입장과 서비스를 제공하는 입장으로 나뉜다.

- 서비스를 제공받는 입장: 집에서 인터넷을 접속, 회사에서 인터넷에 접속, 출근길에 모바일로 접속
- 서비스를 제공하는 입장: 클라우드, 데이터 센터, 회사 서버실에 서버를 놓고 API를 제공

### 홈 네트워크

![](https://images.velog.io/images/songs4805/post/11340150-6682-47b6-bad7-c2dd4de7d6bc/image.png)

홈 네트워크 구성은 어떤 인터넷 회선(FTTH, 케이블 인터넷, VDSL)을 연결하더라도 같다. 무선인터넷도 크게 다르지 않다. 홈 네트워크를 구성하는 데는 모뎀, 공유기, 단말 간 물리적 연결이 필요하다.

무선일 경우 무선 랜 카드와 무선 신호를 보낼 수 있는 매체(공기)가 필요하고, 유선 연결은 유선 랜카드(이더넷 랜 카드), 랜 케이블(랜선)이 필요하다.

### 데이터 센터 네트워크

![](https://images.velog.io/images/songs4805/post/fbeee41b-d21b-4520-90fb-3de158d9a86f/image.png)

데이터 센터 네트워크는 안정적이고 빠른 대용량 서비스 제공을 목표로 구성한다.  
안정적인 서비스 제공을 위해 다양한 이중화 기술을 사용해야 하고 많은 서버와 서비스가 한 네트워크에 연결되어 있으므로 높은 통신량을 수용할 수 있어야 한다. 이런 조건을 만족하기 위해 고속 이더넷 기술(10G, 25G, 40G, 100G, 400G)로 높은 통신양을 수용할 수 있어야 한다.

기존에는 3계층 구성 방식이 일반적이었지만, 가상화 기술과 높은 대역폭을 요구하는 **스케일 아웃(Scale-Out) 기반**의 애플리케이션과 서비스가 등장하면서 2계층 구성인 **스파인 리프(Spine-Leaf) 구조**로 데이터 센터 네트워크가 변화되었다.

### 스파인 리프(Spine-Leaf) 구조

서버 간 통신이 늘어나는 최근 트래픽 경향을 지원하기 위해 제안되었다.

![](https://images.velog.io/images/songs4805/post/395e3fa7-d2c5-40b9-b2ec-b20e6386c982/image.png)

// 리프 스위치는 랙에 장착되어 해당 랙의 서버 통신을 책임진다.

최근에는 일반 서버에도 10G Base-T 이더넷 포트가 기본적으로 제공되어 TOR(Top of Rack) 스위치와 연결되고 리프스위치인 TOR 스위치는 스파인 스위치와 40G, 100G로 연결되는 추세이다. 더 높은 대역폭을 제공하기 위해 400G 네트워크도 표준화되어 더 높은 대역폭을 사용하는 데이터 센터에 사용되고 있다.

## 2. 프로토콜

> 📌 **프로토콜: 규정이나 규약과 관련된 내용으로 네트워크에선 통신할 때의 규약을 말한다.**

과거에는 어떤 표준협회냐, 어떤 워킹그룹이냐, 어떤 회사에서 사용하느냐에 따라 특징이 다른 다양한 프로토콜이 존재해왔지만, 현재는 **이더넷-TCP/IP** 기반 프로토콜로 획일화 되고있는 추세이다.

- 물리적 측면: 데이터 전송 매체, 신호 규약, 회선 규격 등. **이더넷**이 널리 쓰임.
- 논리적 측면: 장치들끼리 통신하기 위한 프로토콜 규격. **TCP.IP**가 널리 쓰임.

과거에는 적은 컴퓨팅 자원과 매우 느린 네트워크 속도를 이용해 최대한 효율적으로 통신하는 것이 목표였어서 대부분의 프로토콜이 문자 기반이 아닌 2진수 비트(bit) 기반으로 만들어졌다. 최소한의 비트로 내용을 전송하기 위해 매우 엄격하게 정의해서 작성을 해야 했다.

하지만, 애플리케이션 레벨의 프로토콜은 비트 기반이 아닌 문자 기반 프로토콜이 사용되고 있다. 헤더와 헤더 값, 데이터 등을 사용자가 읽기 쉽도록 문자로 작성해서 전송한다. 대표적으로 HTTP, SMTP와 같은 프로토콜이 대표적이다.

```http
GET /api HTTP/1.1
Accept: text/html, application/xhtml+xml, */*
Referer: http://zigispace.net/
Accept-Language: ko-KR
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; TCO_20181006113830; rv:11.0) like Gecko
Accept-Encoding: gzip, deflate
Host: theplmingspace.tistory.com
DNT: 1
Connection: Keep-Alive
```

실제 텍스트(text) 파일과 같은 데이터가 전달되기 때문에 효율성은 비트 기반 프로토콜보다 떨어지지만 다양한 확장이 가능하다.

### TCP/IP 프로토콜 스택

- TCP/IP는 프로토콜 스택이라 부른다.
- TCP와 IP는 별도 레이어(TCP는 트랜스포트 계층, IP는 네트워크 계층)에서 동작하는 프로토콜이지만 함께 사용하고 있는데 이런 프로토콜 묶음을 프로토콜 스택이라 한다.
- TCP/IP 프로토콜 스택에는 실제로 TCP와 IP뿐만 아니라 UDP, ICMP, ARP, HTTP, SMTP, FTP와 같은 다양한 애플리케이션 레이어 프로토콜들이 있다.
- TCP/IP 프로토콜 스택은 다음과 같은 구성으로 4개 부분으로 나뉜다.

![](https://images.velog.io/images/songs4805/post/505a7503-9b99-4a21-95e3-8e901fa735cc/image.png)

## 3. OSI 7계층과 TCP/IP

OSI 7 계층과 TCP/IP 프로토콜 스택은 복잡한 네트워크를 단계별로 나누어 이해하기 쉽도록 한다.

### OSI 7계층

과거에는 통신용 규약이 표준화되지 않았고 각 벤더에서 별도로 개발했기 때문에 호환되지 않는 시스템이나 애플리케이션이 많았고 통신이 불가능했다. 이를 하나의 규약으로 통합하려는 노력이 현재의 OSI 7계층으로 남아있다.

네트워크의 동작을 7계층으로 나누어 이해하고 개발하는데 많은 도움이 되므로 네트워크의 주요 레퍼런스 모델로 활용되고 있지만, 현재는 대부분의 프로토콜이 TCP/IP 프로토콜 스택 기반으로 되어있다.

![](https://images.velog.io/images/songs4805/post/bed7ddd9-59bf-4ad8-949d-01da144c4681/image.png)

이렇게 프로토콜이 계층별로 표준화되면 나뉜 템플릿을 통해 네트워크 프로토콜을 전부 개발하는 대신 계층별로 프로토콜을 개발해 네트워크 구성 요소들을 모듈화할 수 있다. 모듈화된 요소는 기존에 개발된 프로토콜과 연동하여 사용할 수 있다.

또한, OSI 7계층은 다시 두 가지 계층으로 나뉠 수 있다.

- 1~4 계층: 데이터 플로 계층(Data Flow Layer) / 하위 계층(Lower Layer)
- 5~7 계층: 애플리케이션 계층(Application Layer) / 상위 계층(Upper Layer)

데이터 플로 계층은 애플리케이션 개발자가 해당 계층 프로토콜을 개발할 때 하위 계층을 고려하지 않고 데이터를 표현하는데 초점을 맞춘다.  
애플리케이션 계층은 애플리케이션 개발자들이 고려해야 할 영역이므로 네트워크 엔지니어는 이 부분에 대해 심각하게 고려하지 않는다.

이러한 역할 차이로 인해 애플리케이션 계층을 맡는 개발자와 데이터 플로 계층을 맡는 네트워크 엔지니어는 OSI 7계층을 각각 하향식, 상향식 형식으로 네트워크를 인식한다.

![](https://images.velog.io/images/songs4805/post/a5fb9f8d-5e9a-4373-8dbc-1b460b4c1322/image.png)

### TCP/IP 프로토콜 스택

이론보다 실용성에 중심을 둔 프로토콜인 TCP/IP는 4계층으로 구분한다.

![](https://images.velog.io/images/songs4805/post/2d904cb4-1cef-47cf-b09d-085b35f819ce/image.png)

OSI 7계층은 데이터 플로 계층과 애플리케이션 계층으로 묶어 구분할 수 있는데, 이는 데이터를 전달하는데 집중하는 영역과 애플리케이션에 집중하는 영역으로 구분한 것이다. 따라서 서버 엔지니어와 네트워크 엔지니어가 고려해야 할 부분이 다르고 그렇기에 상향식, 하향식 개발 관점으로 보는데 TCP/IP 모델은 이러한 구분이 더 확연히 드러난다.

상위 3개 계층을 하나의 애플리케이션 계층으로 묶고, 1, 2계층을 하나의 네트워크 계층으로 구분한다. 이는 현실에 쉽게 반영하도록 간단히 구분하고자 하는 의도를 볼 수 있다.

## 4. OSI 7계층별 이해하기

OSI 7계층은 참조형 모델이고 실제로 사용하는 프로토콜은 TCP/IP 프로토콜 스택으로 구현되어 있지만 OSI 7계층을 조금 더 자세히 나누어 알아보자.

### 1계층(물리 계층)

**물리적 연결과 관련된 정보를 정의하는 계층**이다.

- 주로 전기 신호를 전달하는데 초점이 맞추어져 있다.
- 주요 장비로 허브(Hub), 리피터(Repeater), 케이블(Cable), 커넥터(Connector), 트랜시버(Tranceiver), 탭(TAP) 등이 있다.
- 1계층은 들어온 전기 신호를 그대로 잘 전달하는 것이 목적이다.
- 주소의 개념이 없어 전기 신호가 들어온 포트를 제외하고 모든 포트에 같은 전기 신호를 전송한다.

### 2계층(데이터 링크 계층)

**전기 신호를 우리가 알아볼 수 있는 데이터 형태로 처리하는 계층**이다.

- 주소 정보를 정의하고 정확한 주소로 통신이 되도록 하는 데 초점이 맞추어져 있다.
- 출발지와 도착지 주소를 확인하고 내게 보낸 것이 맞는지, 또는 내가 처리해야 하는지에 대해 검사한 후 데이터 처리를 수행한다.
- 여러 통신이 한꺼번에 이루어지는 것을 구분하기 위한 기능이 정의된다.
- 전기 신호를 모아 데이터 형태로 처리하므로 데이터에 대한 에러 탐지 및 수정 역할을 수행한다.  
  // 현재 이더넷 기반 네트워크의 2계층에선 에러를 탐지하는 역할만 수행한다.
- 받는 사람이 현재 데이터를 받을 수 있는지 확인하는 작업(Flow Control)을 수행해야 한다.

![](https://images.velog.io/images/songs4805/post/a35857c6-6449-451b-892d-93a974dffc5a/image.png)

- 2계층에서 동작하는 네트워크 구성 요소는 네트워크 인터페이스 카드와 스위치이다.
- **2계층의 가장 중요한 특징은 MAC 주소라는 주소 체계가 있다는 것이다.**
- 스위치는 MAC 주소를 보고 통신해야 할 포트를 지정해 내보낼 수 있다.
- 네트워크 인터페이스 카드에는 고유 MAC 주소가 있어 이를 이용해 전기 신호가 자신에게 들어오는 것이 맞는지 확인 후 맞을 경우 상위 계층에서 해당 데이터를 처리할 수 있도록 메모리에 적재한다.
- 스위치는 단말이 어떤 MAC 주소인지, 연결된 포트는 어느 것인지 주소 습득과정을 통해 알 수 있다.
- 스위치의 필터링과 포워딩 기능으로 통신이 필요한 프로토콜만 사용하고 네트워크 전체에 불필요한 처리가 감소하면서 이더넷 네트워크 효율성이 크게 향상되어 이더넷 기반 네트워크가 급증하는 계기가 되었다.

> 📌 네트워크 인터페이스 카드 동작 방식?  
> ![](https://images.velog.io/images/songs4805/post/e6336c94-ea75-4e0e-881f-18edc09e07d3/image.png)
>
> 1. 전기 신호를 데이터 형태로 만든다.
> 2. 목적지 MAC 주소와 출발지 MAC 주소 확인
> 3. 네트워크 인터페이스 카드의 MAC 주소 확인
> 4. 두 MAC 주소가 맞으면 데이터를 처리하고 아니면 데이터를 폐기한다.

### 3계층(네트워크 계층)

**논리적인 주소(IP)가 정의되며 라우터로 최적 경로를 찾아 패킷을 전송하는 계층**이다.

![](https://images.velog.io/images/songs4805/post/44c66a04-5df5-4c24-a52e-8d381c99d141/image.png)

- 3계층에서는 IP주소와 같은 논리적인 주소가 정의된다.
- IP주소는 변경이 가능하고, 네트워크 주소 부분과 호스트 주소 부분으로 나뉜다.

![](https://images.velog.io/images/songs4805/post/c2e19bae-7c72-4b58-b093-803eaa21d251/image.png)

- 라우터를 이용해 IP주소를 이해할 수 있다.
- 라우터는 IP 주소를 사용해 최적의 경로를 찾아주고 해당 경로로 패킷을 전송하는 역할을 한다.

### 4계층(트랜스포트 계층)

**해당 데이터들이 정상적으로 잘 보내지도록 확인하는 역할을 하는 계층**이다.

- 패킷의 유실 및 순서 변경을 검사하고 바로 잡는 역할을 담당한다.
- 4계층에서 패킷을 분할할 때 패킷 헤더에 보내는 순서와 받는 순서를 적어 통신하므로 패킷이 유실되면 재전송을 요청할 수 있고 순서가 뒤바뀌더라도 바로잡을 수 있다.
- 패킷에 보내는 순서를 명시한 것을 **시퀀스 번호(Sequence Number)**라 한다.
- 패킷에 받는 순서를 나타낸 것을 **ACK 번호(Acknowledgement Number)**라 한다.
- 포트번호(Port Number)를 사용해 상위 애플리케이션을 구분한다.
- 4계층에서는 로드 밸런서로 부하 분산을 처리하거나 방화벽으로 보안 정책을 수립해 패킷을 통과, 차단하는 기능을 수행한다.

### 5계층(세션 계층)

**양 끝단의 응용 프로세스의 안정적인 연결 및 끊어주는 역할을 하는 계층**이다.

- TCP/IP 세션을 생성 및 삭제하는 책임을 가진다.
- 에러로 중단된 통신에 대한 에러 복구와 재전송을 수행한다.

### 6계층(프레젠테이션 계층)

**표현 방식이 다른 애플리케이션이나 시스템 간의 통신을 돕기 위해 하나의 통일된 구문 형식으로 변환시키는 기능을 수행하는 계층**이다.

- 사용자 시스템의 응용 계층에서 데이터의 형식상 차이를 다루는 부담을 덜어준다.
- MIME 인코딩이나 암호화, 압축, 코드 변환과 같은 동작이 이루어진다.

### 7계층(애플리케이션 계층)

**애플리케이션 프로세스를 정의하고 애플리케이션 서비스를 수행하는 계층**이다.

- 네트워크 소프트웨어의 UI 부분이나 사용자 입/출력 부분을 정의한다.
- 애플리케이션 계층의 프로토콜은 매우 다양하다. (FTP, SMTP, HTTP, TELNET, ...)

📌 계층별 주요 프로토콜 및 장비

| 계층              | 주요 프로토콜                                      | 장비                          |
| ----------------- | -------------------------------------------------- | ----------------------------- |
| 애플리케이션 계층 | HTTP, SMP, SMTP, STUN, TFTP, TELNET                | ADC, NGFW, WAF                |
| 프레젠테이션 계층 | TLS, AFP, SSH                                      |                               |
| 세션 게층         | L2TP, PPTP, NFS, RCP, RTCP, SIP, SSH               |                               |
| 트랜스포트 계층   | TCP, UDP, SCTP, DCCP, AH, AEP                      | 로드 밸런서, 방화벽           |
| 네트워크 계층     | ARP, IPv4, IPv6, NAT, IPSec, VRRP, 라우팅 프로토콜 | 라우터, L3 스위치             |
| 데이터 링크 계층  | IEEE 802.2, FDDI                                   | 스위치, 브릿지, 네트워크 카드 |
| 물리 계층         | RS-232, RS-449, V.35, S 등의 케이블                | 케이블, 허브, 탭(TAP)         |

## 5. 인캡슐레이션과 디캡슐레이션

- **인캡슐레이션**: 상위 계층에서 하위 계층으로 데이터를 보내면서 물리 계층에서 전기 신호 형태로 네트워크를 통해 신호를 보내는 과정
- **디캡슐레이션**: 전기 신호를 받아 데이터화하여 하위계층에서 상위계층으로 전달하는 과정

![](https://images.velog.io/images/songs4805/post/64963409-3e75-4ddb-b466-9b935e6eb76d/image.png)

현대 네트워크는 대부분 패킷 기반 네트워크이다. 데이터를 패킷이라는 작은 단위로 쪼개 보내는데 이런 기법으로 하나의 통신이 회선 전체를 점유하지 않고 동시에 여러 단말이 통신하도록 해준다.

나뉜 패킷에 데이터를 분할해서 넣는 과정을 인캡슐레이션이라 한다.

데이터를 패킷에 담을 때 각 계층별로 자신이 필요한 정보를 헤더에 붙여넣는데, 4,3,2 계층으로 내려가면서 필요한 헤더 정보를 비트 단위로 작성한다. 그렇기에 하나의 데이터를 전송하면 데이터 플로 계층에서만 3개의 헤더 정보가 추가된다.

받는 쪽에서는 디캡슐레이션 과정을 수행한다. 받은 전기 신호를 데이터 형태로 만들어 2계층으로 올려보낸다. 2계층에서는 2계층 해더에 포함된 정보를 확인하고 목적지가 자신이 맞는지 확인한다. 목적지가 맞다면 2계층 헤더 정보는 벗겨내고 3계층으로 올려보내고 동일한 과정을 반복하여 애플리케이션 계층으로 올려보낸다.

![](https://images.velog.io/images/songs4805/post/57cd0d5c-aba5-461d-99a3-70f571986052/FC3EDE52-20FD-47FC-95FF-7064B28418BC_1_102_a.jpeg)

## MSS, MTU(데이터 크기 조절)

![](https://images.velog.io/images/songs4805/post/6439eb89-645a-4150-8e4a-5fc4f224e070/image.png)

- MSS(Maximum Segment Size): 네트워크에서 수용할 수 있는 크기를 역산해 데이터가 4계층으로 데이터가 내려올 때 적절한 크기로 쪼개질 수 있도록 유도하는 크기로, 4계층에서 가질 수 있는 최대 데이터 값이다.
- MTU(Maximum Transmission Unit): 네트워크에서 한 번에 보낼 수 있는 데이터 크기로, 2계층의 데이터 값으로 일반적인 이더넷에서 수용할 수 있는 크기는 1500바이트 이다.
