# Chapter 4 - μ¤νΈλ¦Ό μ†κ°
## μ¤νΈλ¦Όμ΄λ€ λ¬΄μ—‡μΈκ°€?
μ¤νΈλ¦Ό(Stream)μ€ Java 8 APIμ— μƒλ΅ μ¶”κ°€λ κΈ°λ¥μ΄λ‹¤. μ¤νΈλ¦Όμ„ μ΄μ©ν•λ©΄ μ„ μ–Έν•(λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•λ” μ„μ‹ κµ¬ν„ μ½”λ“ λ€μ‹  μ§μλ΅ ν‘ν„ν•  μ μλ‹¤)μΌλ΅ μ»¬λ ‰μ… λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•  μ μλ‹¤. λν• λ©€ν‹°μ¤λ λ“ μ½”λ“λ¥Ό κµ¬ν„ν•μ§€ μ•μ•„λ„ λ°μ΄ν„°λ¥Ό ν¬λ…ν•κ² λ³‘λ ¬λ΅ μ²λ¦¬ν•  μ μλ‹¤.

μ €μΉΌλ΅λ¦¬μ μ”λ¦¬λ…μ„ λ°ν™ν•κ³ , μΉΌλ΅λ¦¬λ¥Ό κΈ°μ¤€μΌλ΅ μ”λ¦¬λ¥Ό μ •λ ¬ν•λ” μ½”λ“κ°€ μλ‹¤.
```java
List<Dish> lowCaloricDishes = new ArrayList<>();
for(Dish dish : menu) {
    if(dish.getCalories() < 400>) {
        lowCaloricDishes.add(dish);
    }
}
Collections.sort(lowCaloricDishes, new Comparator<Dish>() {
    public int compare(Dish dish1, Dish dish2) {
        return Integer.compare(dish1.getCalories(), dish2.getCalories());
    }
});
List<String> lowCaloricDishesName = new ArrayList<>();
for(Dish dish : lowCaloricDishes) {
    lowCaloricDishesName.add(dish.getName());
}
```
lowCaloricDishesλΌλ” 'κ°€λΉ„μ§€ λ³€μ'λ¥Ό μ‚¬μ©ν–λ‹¤. μ΄λ” μ»¨ν…μ΄λ„ μ—­ν• λ§ ν•λ” μ¤‘κ°„ λ³€μμ΄λ‹¤.

```java
import static java.util.Comparator.comparing;
import static java.util.stream.Collectors.toList;
List<String> lowCaloricDishesName = menu.stream()
                                        .filter(d -> d.getCalories() < 400)
                                        .sorted(comparing(Dish::getCalories))
                                        .map(Dish::getName)
                                        .collect(toList());
```
μ¤νΈλ¦ΌμΌλ΅ μ²λ¦¬ν• λ‘κ°™μ€ λ΅μ§μ΄λ‹¤.

μ¤νΈλ¦Όμ„ μ΄μ©ν•  λ•μ μ¥μ μ€ λ‹¤μκ³Ό κ°™λ‹¤.
- μ„ μ–Έν•μΌλ΅ μ½”λ“λ¥Ό κµ¬ν„ν•  μ μλ‹¤.   
// κΈ°μ΅΄ μ½”λ“λ¥Ό λ³µμ‚¬ν•μ—¬ λ¶™μ—¬ λ„£λ” λ°©μ‹μ„ μ‚¬μ©ν•μ§€ μ•κ³  λλ‹¤ ν‘ν„μ‹μ„ μ΄μ©ν•μ—¬ μ‰½κ² κµ¬ν„ κ°€λ¥.
- κ°€λΉ„μ§€ λ³€μλ¥Ό λ§λ“¤μ§€ μ•λ”λ‹¤.
- μ—¬λ¬ λΉλ”© λΈ”λ΅ μ—°μ‚°μ„ μ—°κ²°ν•΄μ„ λ³µμ΅ν• λ°μ΄ν„° μ²λ¦¬ νμ΄ν”„λΌμΈμ„ λ§λ“¤ μ μμΌλ©°, μ—¬μ „ν κ°€λ…μ„±κ³Ό λ…ν™•μ„±μ΄ μ μ§€λλ‹¤.
- filter, map, sorted, collect κ°™μ€ μ—°μ‚°μ€ κ³ μμ¤€ λΉλ”© λΈ”λ΅(high-level building block)μΌλ΅ μ΄λ£¨μ–΄μ Έ μμΌλ―€λ΅ νΉμ • μ¤λ λ”© λ¨λΈμ— μ ν•λμ§€ μ•κ³  μμ λ΅­κ² μ–΄λ–¤ μƒν™©μ—μ„λ“  μ‚¬μ©ν•  μ μλ‹¤.

μ¤νΈλ¦Ό APIμ νΉμ§•μ„ λ‹¤μκ³Ό κ°™μ΄ μ”μ•½ν•  μ μλ‹¤.
- μ„ μ–Έν•: λ” κ°„κ²°ν•κ³  κ°€λ…μ„±μ΄ μΆ‹μ•„μ§„λ‹¤.
- μ΅°λ¦½ν•  μ μμ: μ μ—°μ„±μ΄ μΆ‹μ•„μ§„λ‹¤.
- λ³‘λ ¬ν™”: μ„±λ¥μ΄ μΆ‹μ•„μ§„λ‹¤.

## μ¤νΈλ¦Ό μ‹μ‘ν•κΈ°
μ¤νΈλ¦Όμ΄λ€ 'λ°μ΄ν„° μ²λ¦¬ μ—°μ‚°μ„ μ§€μ›ν•λ„λ΅ μ†μ¤μ—μ„ μ¶”μ¶λ μ—°μ†λ μ”μ†'λ΅ μ •μν•  μ μλ‹¤.
- μ—°μ†λ μ”μ†: μ¤νΈλ¦Όμ€ νΉμ • μ”μ† ν•μ‹μΌλ΅ μ΄λ£¨μ–΄μ§„ μ—°μ†λ κ°’ μ§‘ν•©μ μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•λ‹¤. filter, sorted, mapμ²λΌ ν‘ν„ κ³„μ‚°μ‹μ΄ μ£Όλ¥Ό μ΄λ£¬λ‹¤.
- μ†μ¤: μ¤νΈλ¦Όμ€ μ»¬λ ‰μ…, λ°°μ—΄, I/O μμ› λ“±μ λ°μ΄ν„° μ κ³µ μ†μ¤λ΅λ¶€ν„° λ°μ΄ν„°λ¥Ό μ†λΉ„ν•λ‹¤.
- λ°μ΄ν„° μ²λ¦¬ μ—°μ‚°: μ¤νΈλ¦Όμ€ ν•¨μν• ν”„λ΅κ·Έλλ° μ–Έμ–΄μ—μ„ μΌλ°μ μΌλ΅ μ§€μ›ν•λ” μ—°μ‚°κ³Ό λ°μ΄ν„°λ² μ΄μ¤μ™€ λΉ„μ·ν• μ—°μ‚°μ„ μ§€μ›ν•λ©°, μμ°¨μ μΌλ΅ λλ” λ³‘λ ¬λ΅ μ‹¤ν–‰ν•  μ μλ‹¤.

μ¤νΈλ¦Όμ€ λ‹¤μκ³Ό κ°™μ€ λ‘ κ°€μ§€ μ¤‘μ” νΉμ§•μ΄ μλ‹¤.
- νμ΄ν”„λΌμ΄λ‹(Pipelining): μ¤νΈλ¦Ό μ—°μ‚°μ€ μ¤νΈλ¦Ό μ—°μ‚°λΌλ¦¬ μ—°κ²°ν•΄μ„ μ»¤λ‹¤λ€ νμ΄ν”„λΌμΈμ„ κµ¬μ„±ν•  μ μλ„λ΅ μ¤νΈλ¦Ό μμ‹ μ„ λ°ν™ν•λ‹¤. κ·Έ λ•λ¶„μ— κ²μΌλ¦„(lazyness), μ‡ΌνΈμ„ν‚·(short-circuiting) κ°™μ€ μµμ ν™”λ„ μ–»μ„ μ μλ‹¤.
- λ‚΄λ¶€ λ°λ³µ: λ°λ³µμλ¥Ό μ΄μ©ν•΄μ„ λ…μ‹μ μΌλ΅ λ°λ³µν•λ” μ»¬λ ‰μ…κ³Ό λ‹¬λ¦¬ μ¤νΈλ¦Όμ€ λ‚΄λ¶€ λ°λ³µμ„ μ§€μ›ν•λ‹¤.

## μ¤νΈλ¦Όκ³Ό μ»¬λ ‰μ…
μ»¬λ ‰μ…κ³Ό μ¤νΈλ¦Ό λ¨λ‘ μ—°μ†λ μ”μ† ν•μ‹μ κ°’μ„ μ €μ¥ν•λ” μλ£κµ¬μ΅°μ μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•λ‹¤.    
μ»¬λ ‰μ…κ³Ό μ¤νΈλ¦Όμ κ°€μ¥ ν° μ°¨μ΄λ” _λ°μ΄ν„°λ¥Ό μ–Έμ  κ³„μ‚°ν•λλƒ_ μ΄λ‹¤.    
μ»¬λ ‰μ…μ€ ν„μ¬ μλ£κµ¬μ΅°κ°€ ν¬ν•¨ν•λ” λ¨λ“  κ°’μ„ λ©”λ¨λ¦¬μ— μ €μ¥ν•λ” μλ£κµ¬μ΅°μ΄λ‹¤. μ¦‰, __μ»¬λ ‰μ…μ λ¨λ“  μ”μ†λ” μ»¬λ ‰μ…μ— μ¶”κ°€ν•κΈ° μ „μ— κ³„μ‚°λμ–΄μ•Ό ν•λ‹¤.__ λ°λ©΄ μ¤νΈλ¦Όμ€ μ΄λ΅ μ μΌλ΅ __μ”μ²­ν•  λ•λ§ μ”μ†λ¥Ό κ³„μ‚°__ ν•λ” κ³ μ •λ μλ£κµ¬μ΅°λ‹¤. μ΄λ¬ν• μ¤νΈλ¦Όμ νΉμ„±μ€ __κ²μΌλ¥Έ μƒμ„±__ μ„ κ°€λ¥ν•κ² ν•λ‹¤.

μ¤νΈλ¦Όμ€ λ°λ³µμμ™€ λ§μ°¬κ°€μ§€λ΅ ν• λ²λ§ νƒμƒ‰ν•  μ μλ‹¤. νƒμƒ‰λ μ¤νΈλ¦Όμ μ”μ†λ” μ†λΉ„λλ‹¤.

## μ™Έλ¶€ λ°λ³µκ³Ό λ‚΄λ¶€ λ°λ³µ
μ»¬λ ‰μ… μΈν„°νμ΄μ¤λ¥Ό μ‚¬μ©ν•λ ¤λ©΄ μ‚¬μ©μκ°€ μ§μ ‘ μ”μ†λ¥Ό λ°λ³µν•΄μ•Ό ν•λ‹¤. for-eachλ‚ Iteratorλ¥Ό μ΄μ©ν•΄μ„ λ°λ³µν•  μ μμΌλ©° μ΄λ¥Ό __μ™Έλ¶€ λ°λ³µ(external iteration)__ μ΄λΌκ³  ν•λ‹¤. λ°λ©΄ μ¤νΈλ¦Ό λΌμ΄λΈλ¬λ¦¬λ” λ°λ³µμ„ μ•μ•„μ„ μ²λ¦¬ν•κ³  κ²°κ³Ό μ¤νΈλ¦Ό κ°’μ„ μ €μ¥ν•΄μ£Όλ” __λ‚΄λ¶€ λ°λ³µ(internal iteration)__ μ„ μ‚¬μ©ν•λ‹¤.

ex) μ»¬λ ‰μ…: for-each λ£¨ν”„λ¥Ό μ΄μ©ν•λ” μ™Έλ¶€ λ°λ³µ
```java
List<String> names = new ArrayList<>();
for(Dish dish : menu) {    // λ©”λ‰΄ λ¦¬μ¤νΈλ¥Ό λ…μ‹μ μΌλ΅ μμ°¨ λ°λ³µν•λ‹¤.
    names.add(dish.getName()); // μ΄λ¦„μ„ μ¶”μ¶ν•΄μ„ λ¦¬μ¤νΈμ— μ¶”κ°€ν•λ‹¤.
}
```

ex) μ¤νΈλ¦Ό: λ‚΄λ¶€λ°λ³µ
```java
List<String> names = menu.stream()
                         .map(Dish::getName) // map λ©”μ„λ“λ¥Ό getName λ©”μ„λ“λ΅ νλΌλ―Έν„°ν™” ν•΄μ„ μ”λ¦¬λ…μ„ μ¶”μ¶ν•¨.
                         .collect(toList()); // νμ΄ν”„λΌμΈμ„ μ‹¤ν–‰ν•λ‹¤. λ°λ³µμλ” ν•„μ” μ—†μ
```

λ‚΄λ¶€ λ°λ³µμ„ μ΄μ©ν•λ©΄ μ‘μ—…μ„ ν¬λ…ν•κ² λ³‘λ ¬λ΅ μ²λ¦¬ν•κ±°λ‚ λ” μµμ ν™”λ λ‹¤μ–‘ν• μμ„λ΅ μ²λ¦¬ν•  μ μλ‹¤. μ¤νΈλ¦Ό λΌμ΄λΈλ¬λ¦¬μ λ‚΄λ¶€ λ°λ³µμ€ λ°μ΄ν„° ν‘ν„κ³Ό ν•λ“μ›¨μ–΄λ¥Ό ν™μ©ν• λ³‘λ ¬μ„± κµ¬ν„μ„ μλ™μΌλ΅ μ„ νƒν•λ‹¤. λ°λ©΄ for-eachλ¥Ό μ΄μ©ν•λ” μ™Έλ¶€ λ°λ³µμ—μ„λ” λ³‘λ ¬μ„±μ„ μ¤μ¤λ΅ κ΄€λ¦¬ν•΄μ•Ό ν•λ‹¤.

## μ¤νΈλ¦Ό μ—°μ‚°: μ¤‘κ°„ μ—°μ‚°κ³Ό μµμΆ… μ—°μ‚°
μ¤νΈλ¦Όμ€ μ—°κ²°ν•  μ μλ” μ¤νΈλ¦Ό μ—°μ‚°μΈ __μ¤‘κ°„ μ—°μ‚°(intermediate operation)__ κ³Ό μ¤νΈλ¦Όμ„ λ‹«λ” μ—°μ‚°μΈ __μµμΆ… μ—°μ‚°(terminal operation)__ μΌλ΅ κµ¬μ„±λλ‹¤.

μ¤‘κ°„ μ—°μ‚°μ€ λ‹¤λ¥Έ μ¤νΈλ¦Όμ„ λ°ν™ν•λ‹¤. λ”°λΌμ„ μ—¬λ¬ μ¤‘κ°„ μ—°μ‚°μ„ μ—°κ²°ν•΄μ„ μ§μλ¥Ό λ§λ“¤ μ μλ‹¤. μ¤‘κ°„ μ—°μ‚°μ κ°€μ¥ μ¤‘μ”ν• νΉμ§•μ€ λ‹¨λ§ μ—°μ‚°μ„ μ¤νΈλ¦Ό νμ΄ν”„λΌμΈμ— μ‹¤ν–‰ν•κΈ° μ „κΉμ§€λ” μ•„λ¬΄ μ—°μ‚°λ„ μν–‰ν•μ§€ μ•λ”λ‹¤λ” κ²ƒ, μ¦‰ κ²μΌλ¥΄λ‹¤(lazy)λ” κ²ƒμ΄λ‹¤. μ¤‘κ°„ μ—°μ‚°μ„ ν•©μΉ λ‹¤μμ— ν•©μ³μ§„ μ¤‘κ°„ μ—°μ‚°μ„ μµμΆ… μ—°μ‚°μΌλ΅ ν• λ²μ— μ²λ¦¬ν•κΈ° λ•λ¬Έμ΄λ‹¤.
```java
List<String> names = menu.stream() // μ¤νΈλ¦Ό open
                         .filter(dish -> { // μ¤‘κ°„ μ—°μ‚° μ‹μ‘
                                 System.out.println("filtering:" + dish.getName());
                                 return dish.getCalories() > 300;
                         }) // ν•„ν„°λ§ν• μ”λ¦¬λ…μ„ μ¶λ ¥ν•λ‹¤.
                         .map(dish -> {
                                 System.out.println("mapping:" + dish.getName());
                                 return dish.getName();
                         }) // μ¶”μ¶ν• μ”λ¦¬λ…μ„ μ¶λ ¥ν•λ‹¤.
                         .limit(3) // μ¤‘κ°„ μ—°μ‚° λ. short-circuit
                         .collect(toList());
System.out.println(names);
```
```bash
// μ‹¤ν–‰ κ²°κ³Ό
filtering:pork
mapping:pork
filtering:beef
mapping:beef
filtering:chicken
mapping:chicken
[pork, beef, chicken]
```

μ¤νΈλ¦Όμ κ²μΌλ¥Έ νΉμ„± λ•λ¶„μ— μ–»μ„ μ μλ” λ‡ κ°€μ§€ μµμ ν™” ν¨κ³Όκ°€ μλ‹¤.
- μ‡ΌνΈ μ„ν‚·: λ¨λ“  μ—°μ‚°μ„ λ‹¤ ν•΄λ³΄κΈ° μ „μ— μ΅°κ±΄μ„ λ§μ΅±ν•λ©΄ μ¶”κ°€μ μΈ λ¶ν•„μ”ν• μ—°μ‚°μ„ ν•μ§€ μ•λ”λ‹¤. μ„μ μμ‹μ—μ„λ” limit μ—°μ‚°μ΄ μ‡ΌνΈ μ„ν‚· μ—°μ‚°μ— ν•΄λ‹Ήλλ‹¤. 3κ°μ κ²°κ³Όλ¥Ό μ–»μ€ ν›„ μ•μ„  filterμ™€ mapμ—°μ‚°μ€ λ” μ΄μƒ μν–‰ν•  ν•„μ”κ°€ μ—†μ–΄ λΉ λ¥΄κ² μµμΆ… μ—°μ‚°μ„ μν–‰ν•λ‹¤.
- λ£¨ν”„ ν“¨μ „(loop fusion): μ„μ μμ‹ μ½”λ“μ—μ„ filterμ™€ map μ—°μ‚°μ— κ°’μ„ print ν•λ” κ³Όμ •μ„ μ¶”κ°€ν•λ‹¤λ©΄ filterμ™€ mapμ€ μ„λ΅ λ‹¤λ¥Έ μ—°μ‚°μ΄μ§€λ§ ν• κ³Όμ •μΌλ΅ λ³‘ν•©λμ–΄ μ²λ¦¬λ¨μ„ ν™•μΈν•  μ μλ‹¤. λ£¨ν”„ ν“¨μ „μ€ μ΄λ ‡κ² λ‘ μ΄μƒμ μ—°μ‚°μ΄ ν•©μ³ ν•λ‚μ μ—°μ‚°μΌλ΅ μ²λ¦¬λ¨μ„ λ§ν•λ‹¤.

μµμΆ… μ—°μ‚°μ€ μ¤νΈλ¦Ό νμ΄ν”„λΌμΈμ—μ„ κ²°κ³Όλ¥Ό λ„μ¶ν•λ‹¤. μ¤νΈλ¦Ό μ΄μ™Έμ κ²°κ³Όκ°€ λ°ν™λλ” μ—°μ‚°μ„ λ§ν•λ‹¤.

<img src="./images/streamoperation.jpg">

## π“μ •λ¦¬
- μ¤νΈλ¦Όμ€ μ†μ¤μ—μ„ μ¶”μ¶λ μ—°μ† μ”μ†λ΅, λ°μ΄ν„° μ²λ¦¬ μ—°μ‚°μ„ μ§€μ›ν•λ‹¤.
- μ¤νΈλ¦Όμ€ λ‚΄λ¶€ λ°λ³µμ„ μ§€μ›ν•λ‹¤. λ‚΄λ¶€ λ°λ³µμ€ filter, map, sorted λ“±μ μ—°μ‚°μΌλ΅ λ°λ³µμ„ μ¶”μƒν™”ν•λ‹¤.