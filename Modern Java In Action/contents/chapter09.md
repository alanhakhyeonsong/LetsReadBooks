# Chapter 9 - λ¦¬ν©ν„°λ§, ν…μ¤ν…, λ””λ²„κΉ…

## κ°€λ…μ„±κ³Ό μ μ—°μ„±μ„ κ°μ„ ν•λ” λ¦¬ν©ν„°λ§

### μ½”λ“ κ°€λ…μ„± κ°μ„ 

- μµλ… ν΄λμ¤λ¥Ό λλ‹¤ ν‘ν„μ‹μΌλ΅ λ¦¬ν©ν„°λ§ν•κΈ°
  1.  μµλ… ν΄λμ¤μ—μ„ thisλ” μµλ… ν΄λμ¤ μμ‹ μ„ κ°€λ¦¬ν‚¤μ§€λ§ λλ‹¤μ—μ„ thisλ” λλ‹¤λ¥Ό κ°μ‹Έλ” ν΄λμ¤λ¥Ό κ°€λ¦¬ν‚¨λ‹¤.
  2.  μµλ… ν΄λμ¤λ” κ°μ‹Έκ³  μλ” ν΄λμ¤ λ³€μλ¥Ό κ°€λ¦΄ μ μλ‹¤.
  3.  μµλ… ν΄λμ¤λ” μΈμ¤ν„΄μ¤ν™” ν•  λ• λ…μ‹μ μΌλ΅ ν•μ‹μ΄ μ •ν•΄μ§€λ” λ°λ©΄ λλ‹¤μ ν•μ‹μ€ μ½ν…μ¤νΈμ— λ”°λΌ λ‹¬λΌμ§„λ‹¤.

```java
Runnable r1 = new Runnable() { // μµλ… ν΄λμ¤λ¥Ό μ‚¬μ©ν• μ΄μ „ μ½”λ“
    public void run() {
        System.out.println("Hello");
    }
};
Runnable r2 = () -> System.out.println("Hello"); // λλ‹¤λ¥Ό μ‚¬μ©ν• μµμ‹  μ½”λ“

int a = 10;
Runnable r3 = () -> {
    int a = 2; // μ»΄νμΌ μ—λ¬(μ„ 2λ² μ‚¬ν•­ μ°Έκ³ )
    System.out.println(a);
};
Runnable r4 = new Runnable() {
    public void run() {
        int a = 2; // λ¨λ“  κ²ƒμ΄ μ μ‘λ™ν•¨.
        System.out.println(a);
    }
}
```

```java
interface Task {
    public void execute();
}
public static void doSomething(Runnable r) { r.run(); }
public static void doSomething(Task a) { r.execute(); }

doSomething(new Task() { // μµλ… ν΄λμ¤ μ „λ‹¬
    public void execute() {
        System.out.println("Danger danger!!");
    }
});
doSomething(() -> System.out.println("Danger danger!!")); // μ½ν…μ¤νΈμ— λ”°λ¥Έ λ¨νΈν•¨ λ°μƒ

doSomething((Task)() -> System.out.println("Danger danger!!")); // λ…μ‹μ  ν•λ³€ν™μ„ μ΄μ©ν•΄μ„ λ¨νΈν•¨ μ κ±°
```

- λλ‹¤ ν‘ν„μ‹μ„ λ©”μ„λ“ μ°Έμ΅°λ΅ λ¦¬ν©ν„°λ§ν•κΈ°

```java
Map<CaloricLevel, List<Dish>> dishesByCaloricLevel =
    menu.stream()
        .collect(
            groupingBy(dish -> {
                if (dish.getCalories() <= 400) return CaloricLevel.DIET;
                else if (dish.getCalories() <= 700) return CaloricLevel.NORMAL;
                else return CaloricLevel.FAT;
            })
        );

Map<CaloricLevel, List<Dish>> dishesByCaloricLevel =
    menu.stream().collect(groupingBy(Dish::getCaloricLevel)); // λλ‹¤ ν‘ν„μ‹μ„ λ©”μ„λ“λ΅ μ¶”μ¶
```

```java
inventory.sort((Apple a1, Apple a2) -> a1.getWeight().compareTo(a2.getWeight())); // λΉ„κµ κµ¬ν„μ— μ‹ κ²½ μ¨μ•Ό ν•λ” μ½”λ“
inventory.sort(comparing(Apple::getWeight)); // μ½”λ“κ°€ λ¬Έμ  μμ²΄λ¥Ό μ„¤λ…ν•λ‹¤.
```

- λ…λ Ήν• λ°μ΄ν„° μ²λ¦¬λ¥Ό μ¤νΈλ¦ΌμΌλ΅ λ¦¬ν©ν„°λ§ν•κΈ°

```java
// λ‹¤μ μ½”λ“λ” λ‘ κ°€μ§€ ν¨ν„΄(ν•„ν„°λ§κ³Ό μ¶”μ¶)μΌλ΅ μ—‰ν‚¨ μ½”λ“
List<String> dishNames = new ArrayList<>();
for(Dish dish : menu) {
    if(dish.getCalories() > 300) {
        dishNames.add(dish.getName());
    }
}

// λ‹¤μκ³Ό κ°™μ΄ Stream APIλ¥Ό μ‚¬μ©ν•λ©΄ λ¬Έμ λ¥Ό μ§μ ‘μ μΌλ΅ κΈ°μ ν•  μ μκ³  μ‰½κ² λ³‘λ ¬ν™”κ°€ κ°€λ¥ν•λ‹¤.
menu.parallelStream()
    .filter(d -> d.getCalories() > 300)
    .map(Dish::getName)
    .collect(toList());
```

### μ½”λ“ μ μ—°μ„± κ°μ„ 

λλ‹¤ ν‘ν„μ‹μ„ μ΄μ©ν•λ©΄ λ™μ‘ νλΌλ―Έν„°ν™”(behavior parameterzation)μ„ μ‰½κ² κµ¬ν„ν•  μ μλ‹¤. λλ‹¤ ν‘ν„μ‹μ„ μ‚¬μ©ν•κΈ° μ„ν•΄ ν•¨μν• μΈν„°νμ΄μ¤μ— μ μ©ν•΄μ•Ό ν•λ‹¤.

1. μ΅°κ±΄λ¶€ μ—°κΈ° μ‹¤ν–‰: μ½”λ“ λ‚΄λ¶€μ— μ μ–΄ νλ¦„λ¬Έμ΄ λ³µμ΅ν•κ² μ–½ν μ½”λ“λ¥Ό λ³Ό μ μλ‹¤. λ¶ν•„μ”ν• ifλ¬Έμ„ μ κ±°ν•  μ μμΌλ©° μ½”λ“ κ°€λ…μ„±μ΄λ‚ μΊ΅μν™”λ„ κ°•ν™”λλ‹¤.
2. μ‹¤ν–‰ μ–΄λΌμ΄λ“: λ§¤λ² κ°™μ€ μ¤€λΉ„, μΆ…λ£ κ³Όμ •μ„ λ°λ³µμ μΌλ΅ μν–‰ν•λ‹¤λ©΄ μ΄λ¥Ό λλ‹¤λ΅ λ³€ν™ν•  μ μλ‹¤.

## λλ‹¤λ΅ κ°μ²΄μ§€ν–¥ λ””μμΈ ν¨ν„΄ λ¦¬ν©ν„°λ§ν•κΈ°

### μ „λµ(Strategy)

μ „λµ ν¨ν„΄μ€ ν• μ ν•μ μ•κ³ λ¦¬μ¦μ„ λ³΄μ ν• μƒνƒμ—μ„ λ°νƒ€μ„μ— μ μ ν• μ•κ³ λ¦¬μ¦μ„ μ„ νƒν•λ” κΈ°λ²•μ΄λ‹¤. μ „λµμ„ κµ¬ν„ν•λ” μƒλ΅μ΄ ν΄λμ¤λ¥Ό λλ‹¤ ν‘ν„μ‹μ„ ν†µν•΄ μ§μ ‘ μ „λ‹¬ν•  μ μλ‹¤.

### ν…ν”λ¦Ώ λ©”μ„λ“(template method)

μ•κ³ λ¦¬μ¦μ κ°μ”λ¥Ό μ μ‹ν• λ‹¤μμ— μ•κ³ λ¦¬μ¦μ μΌλ¶€λ¥Ό κ³ μΉ  μ μλ” μ μ—°ν•¨μ„ μ κ³µν•΄μ•Ό ν•  λ• ν…ν”λ¦Ώ λ©”μ„λ“ λ””μμΈ ν¨ν„΄μ„ μ‚¬μ©ν•λ‹¤. μ¶”μƒ λ©”μ„λ“λ΅ μ›ν•λ” λ™μ‘μ„ κµ¬ν„ν•λ” κ³³μ„ λλ‹¤ ν‘ν„μ‹μ„ ν†µν•΄ μ „λ‹¬ν•  μ μλ‹¤.

### μµμ €λ²„(observer)

μ–΄λ–¤ μ΄λ²¤νΈκ°€ λ°μƒν–μ„ λ• ν• κ°μ²΄(subject)κ°€ λ‹¤λ¥Έ κ°μ²΄ λ¦¬μ¤ν„°(observer)μ— μλ™μΌλ΅ μ•λ¦Όμ„ λ³΄λ‚΄μ•Ό ν•λ” μƒν™©μ—μ„ μ‚¬μ©ν•λ” ν¨ν„΄μ΄λ‹¤.

```java
interface Observer {
    void notifiy(String tweet);
}
```

Observer μΈν„°νμ΄μ¤λ” μƒλ΅μ΄ νΈμ—μ΄ μμ„ λ• subjectκ°€ νΈμ¶ν•  μ μλ„λ΅ notifyλΌκ³  ν•λ” ν•λ‚μ λ©”μ„λ“λ¥Ό μ κ³µν•λ‹¤. Observer μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•λ” ν΄λμ¤λ¥Ό λ§λ“λ” λ€μ‹  λλ‹¤ ν‘ν„μ‹μ„ μ§μ ‘ μ „λ‹¬ν•΄μ„ μ‹¤ν–‰ν•  λ™μ‘μ„ μ§€μ •ν•  μ μλ‹¤.

ν•μ§€λ§, μµμ €λ²„κ°€ μƒνƒλ¥Ό κ°€μ§€λ©°, μ—¬λ¬ λ©”μ„λ“λ¥Ό μ •μν•λ” λ“± λ³µμ΅ν•λ‹¤λ©΄ λλ‹¤ ν‘ν„μ‹λ³΄λ‹¤ κΈ°μ΅΄μ ν΄λμ¤ κµ¬ν„λ°©μ‹μ„ κ³ μν•λ” κ²ƒμ΄ λ°”λμ§ν•  μ μλ‹¤.

### μλ¬΄ μ²΄μΈ(chain-of-responsibility)

μ‘μ—… μ²λ¦¬ κ°μ²΄μ μ²΄μΈ(λ™μ‘ μ²΄μΈ λ“±)μ„ λ§λ“¤ λ•λ” μλ¬΄ μ²΄μΈ ν¨ν„΄μ„ μ‚¬μ©ν•λ‹¤. ν• κ°μ²΄κ°€ μ–΄λ–¤ μ‘μ—…μ„ μ²λ¦¬ν• λ‹¤μμ— λ‹¤λ¥Έ κ°μ²΄λ΅ κ²°κ³Όλ¥Ό μ „λ‹¬ν•κ³ , λ‹¤λ¥Έ κ°μ²΄λ„ ν•΄μ•Όν•  μ‘μ—…μ„ μ²λ¦¬ν• λ‹¤μμ— λ λ‹¤λ¥Έ κ°μ²΄λ΅ μ „λ‹¬ν•λ” μ‹μ΄λ‹¤.

```java
public abstract class ProcessingObject<T> {
    protected ProcessingObject<T> successor;
    public void setSuccessor(ProcessingObject<T> successor) {
        this.successor = successor;
    }

    public T handle(T input) {
        T r = handleWork(input);
        if (successor != null) {
            return successor.handle(r);
        }
        return r;
    }

    abstract protected T handleWork(T input);
}
```

ProcessingObject ν΄λμ¤λ¥Ό μƒμ†λ°›μ•„ handleWork λ©”μ„λ“λ¥Ό κµ¬ν„ν•μ—¬ λ‹¤μ–‘ν• μΆ…λ¥μ μ‘μ—… μ²λ¦¬ κ°μ²΄λ¥Ό λ§λ“¤ μ μλ‹¤. μ΄λ• μ‘μ—… μ²λ¦¬ κ°μ²΄λ¥Ό UnaryOperator ν•μ‹μ μΈμ¤ν„΄μ¤λ΅ ν‘ν„ν•μ—¬ μ‚¬μ©ν•  μ μλ‹¤.

### ν©ν† λ¦¬(factory)

μΈμ¤ν„΄μ¤ν™” λ΅μ§μ„ ν΄λΌμ΄μ–ΈνΈμ—κ² λ…Έμ¶ν•μ§€ μ•κ³  κ°μ²΄λ¥Ό λ§λ“¤ λ• ν©ν† λ¦¬ λ””μμΈ ν¨ν„΄μ„ μ‚¬μ©ν•λ‹¤. λ¶„κΈ°λ¬Έμ„ ν†µν•΄ μƒν™©μ— λ§λ” κ°μ²΄λ¥Ό λ§λ“¤μ–΄ μ „λ‹¬ν•λ” κ²ƒ λ€μ‹  inputμ„ ν‚¤ Supplierλ¥Ό κ°’μΌλ΅ κ°–λ” Mapμ„ λ§λ“¤κ³ , κ·Έλ¦¬κ³  Supplierλ΅λ” μƒμ„±μ λ©”μ„λ“ μ°Έμ΅°λ¥Ό μ‚¬μ©ν•μ—¬ ν©ν† λ¦¬ ν¨ν„΄μ„ μ‚¬μ©ν•  μ μλ‹¤.

```java
final static Map<String, Supplier<Product>> map = new HashMap<>();
static {
    map.put("loan", Loan::new);
    map.put("stock", Stock::new);
    map.put("bond", Bond::new);
}
```

## λλ‹¤ ν…μ¤ν…

λλ‹¤μ— λ€ν•΄μ„λ„ λ‹¨μ„ ν…μ¤ν…(unit testing)μ΄ μ‘μ„±λμ–΄μ•Όλ§ ν•λ‹¤. ν•μ§€λ§ λλ‹¤λ” μµλ…μ΄λ―€λ΅ ν…μ¤νΈ μ½”λ“ μ΄λ¦„μ„ νΈμ¶ν•  μ μ—†λ‹¤. λ€μ‹  λλ‹¤ ν‘ν„μ‹μ€ ν•¨μν• μΈν„°νμ΄μ¤μ μΈμ¤ν„΄μ¤λ¥Ό μƒμ„±ν•λ‹¤. λ”°λΌμ„ μΈμ¤ν„΄μ¤μ λ™μ‘μΌλ΅ λλ‹¤ ν‘ν„μ‹μ„ ν…μ¤νΈν•  μ μλ‹¤.

λλ‹¤μ λ©ν‘λ” μ •ν•΄μ§„ λ™μ‘μ„ λ‹¤λ¥Έ λ©”μ„λ“μ—μ„ μ‚¬μ©ν•  μ μλ„λ΅ ν•λ‚μ μ΅°κ°μΌλ΅ μΊ΅μν™”ν•λ” κ²ƒμ΄λ‹¤. κ·Έλ¬λ ¤λ©΄ μ„Έλ¶€ κµ¬ν„μ„ ν¬ν•¨ν•λ” λλ‹¤ ν‘ν„μ‹μ„ κ³µκ°ν•μ§€ λ§μ•„μ•Ό ν•λ‹¤.

κ²°κµ­ λλ‹¤μ— λ€ν• ν…μ¤ν…μ€ μ„Έμ„Έν• λλ‹¤μ λ™μ‘ μ¤ν… κ³Όμ •λ§λ‹¤μ μ‚°μ¶λ¬Όμ΄ μ•„λ‹ μ „μ²΄ λλ‹¤ ν‘ν„μ‹μ— λ€ν•μ—¬ μ…λ ¥ν• inputκ³Ό κΈ°λ€ν•λ” outputμ΄ μ λ°ν™λλ”μ§€μ— λ€ν• ν…μ¤νΈκ°€ ν•„μ”ν•λ‹¤.

λ³µμ΅ν• λλ‹¤ ν‘ν„μ‹μ΄λΌλ©΄ κ°λ³„ λ©”μ„λ“λ΅ λ¶„ν• ν•μ—¬ ν…μ¤νΈ λ‹¨μ„λ¥Ό μκ² μΌκ°λ” κ²ƒμ΄λ‹¤. λν• ν•¨μλ¥Ό μΈμλ΅ λ°›κ±°λ‚ λ‹¤λ¥Έ ν•¨μλ¥Ό λ°ν™ν•λ” λ©”μ„λ“λΌλ©΄ ν…μ¤νΈ λ‚΄μ—μ„ λ λ‹¤λ¥Έ λλ‹¤λ¥Ό μ‚¬μ©ν•΄μ„ ν…μ¤νΈν•μ.

## λ””λ²„κΉ…

### μ¤νƒ νΈλ μ΄μ¤ ν™•μΈ

λλ‹¤ ν‘ν„μ‹μ€ μ΄λ¦„μ΄ μ—†κΈ° λ•λ¬Έμ— μ΅°κΈ λ³µμ΅ν• μ¤νƒ νΈλ μ΄μ¤κ°€ μƒμ„±λλ‹¤. κ·Έλ ‡κΈ°μ— λλ‹¤ ν‘ν„μ‹κ³Ό κ΄€λ ¨λ μ¤νƒ νΈλ μ΄μ¤λ” μ΄ν•΄ν•κΈ° μ–΄λ ¤μΈ μ μλ‹¤. μ΄λ” λ―Έλμ μλ°” μ»΄νμΌλ¬κ°€ κ°μ„ ν•΄μ•Ό ν•  λ¶€λ¶„μ΄λ‹¤.

### μ •λ³΄ λ΅κΉ…

forEachλ¥Ό ν†µν•΄ μ¤νΈλ¦Ό κ²°κ³Όλ¥Ό μ¶λ ¥ν•κ±°λ‚ λ΅κΉ…ν•  μ μλ‹¤. ν•μ§€λ§ forEachλ” μ¤νΈλ¦Όμ„ μ†λΉ„ν•λ” μ—°μ‚°μ΄λ‹¤. μ¤νΈλ¦Ό νμ΄ν”„λΌμΈμ— μ μ©λ κ°κ°μ μ—°μ‚°μ κ²°κ³Όλ¥Ό ν™•μΈν•  μ μλ‹¤λ©΄ λ€μ‹  peekλΌλ” μ¤νΈλ¦Ό μ—°μ‚°μ„ ν™μ©ν•  μ μλ‹¤. peekλ” μ¤νΈλ¦Όμ κ° μ”μ†λ¥Ό μ†λΉ„ν• κ²ƒ μ²λΌ λ™μ‘μ„ μ‹¤ν–‰ν•μ§€λ§, μ‹¤μ λ΅ μ¤νΈλ¦Όμ„ μ†λΉ„ν•μ§€ μ•κ³  μμ‹ μ΄ ν™•μΈν• μ”μ†λ¥Ό νμ΄ν”„λΌμΈμ λ‹¤μ μ—°μ‚° κ·Έλ€λ΅ μ „λ‹¬ν•λ‹¤.

## π“ μ •λ¦¬

- λλ‹¤ ν‘ν„μ‹μΌλ΅ κ°€λ…μ„±μ΄ μΆ‹κ³  λ” μ μ—°ν• μ½”λ“λ¥Ό λ§λ“¤ μ μλ‹¤.
- μµλ… ν΄λμ¤λ” λλ‹¤ ν‘ν„μ‹μΌλ΅ λ°”κΎΈλ” κ²ƒμ΄ μΆ‹λ‹¤. ν•μ§€λ§ μ΄λ• this, λ³€μ μ„€λ„ λ“± λ―Έλ¬ν•κ² μλ―Έμƒ λ‹¤λ¥Έ λ‚΄μ©μ΄ μμμ„ μ£Όμν•μ.
- λ©”μ„λ“ μ°Έμ΅°λ΅ λλ‹¤ ν‘ν„μ‹λ³΄λ‹¤ λ” κ°€λ…μ„±μ΄ μΆ‹μ€ μ½”λ“λ¥Ό κµ¬ν„ν•  μ μλ‹¤.
- λ°λ³µμ μΌλ΅ μ»¬λ ‰μ…μ„ μ²λ¦¬ν•λ” λ£¨ν‹΄μ€ μ¤νΈλ¦Ό APIλ΅ λ€μ²΄ν•  μ μμ„μ§€ κ³ λ ¤ν•λ” κ²ƒμ΄ μΆ‹λ‹¤.
- λλ‹¤ ν‘ν„μ‹μΌλ΅ μ „λµ, ν…ν”λ¦Ώ λ©”μ„λ“, μµμ €λ²„, μλ¬΄ μ²΄μΈ, ν©ν† λ¦¬ λ“±μ κ°μ²΄μ§€ν–¥ λ””μμΈ ν¨ν„΄μ—μ„ λ°μƒν•λ” λ¶ν•„μ”ν• μ½”λ“λ¥Ό μ κ±°ν•  μ μλ‹¤.
- λλ‹¤ ν‘ν„μ‹λ„ λ‹¨μ„ ν…μ¤νΈλ¥Ό μν–‰ν•  μ μλ‹¤. ν•μ§€λ§ λλ‹¤ ν‘ν„μ‹ μμ²΄λ¥Ό ν…μ¤νΈν•λ” κ²ƒ λ³΄λ‹¤λ” λλ‹¤ ν‘ν„μ‹μ΄ μ‚¬μ©λλ” λ©”μ„λ“μ λ™μ‘μ„ ν…μ¤νΈν•λ” κ²ƒμ΄ λ°”λμ§ν•λ‹¤.
- λ³µμ΅ν• λλ‹¤ ν‘ν„μ‹μ€ μΌλ° λ©”μ„λ“λ΅ μ¬κµ¬ν„ν•  μ μλ‹¤.
- λλ‹¤ ν‘ν„μ‹μ„ μ‚¬μ©ν•λ©΄ μ¤νƒ νΈλ μ΄μ¤λ¥Ό μ΄ν•΄ν•κΈ° μ–΄λ ¤μ›μ§„λ‹¤.
- μ¤νΈλ¦Ό νμ΄ν”„λΌμΈμ—μ„ μ”μ†λ¥Ό μ²λ¦¬ν•  λ• peek λ©”μ„λ“λ΅ μ¤‘κ°„κ°’μ„ ν™•μΈν•  μ μλ‹¤.
