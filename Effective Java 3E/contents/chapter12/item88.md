# 아이템 88. readObject 메서드는 방어적으로 작성하라
직렬화된 코드는 언제나 역직렬화가 가능하다. 역직렬화를 통한 참조가 가능하고 이를 이용한 공격 방식 또한 존재한다.

**객체를 역직렬화할 때는 클라이언트가 소유해서는 안 되는 객체 참조를 갖는 필드를 모두 방어적으로 복사해야 한다.** 따라서 `readObject`에서는 불변 클래스 안의 모든 private 가변 요소를 방어적으로 복사해야 한다.

## 핵심 정리
- `readObject` 메서드를 작성할 때는 언제나 public 생성자를 작성하는 자세로 임해야 한다.
- `readObject`는 어떤 바이트 스트림이 넘어오더라도 유효한 인스턴스를 만들어내야 한다.
- 바이트 스트림이 진짜 직렬화된 인스턴스라고 가정해서는 안 된다.
- 기본 직렬화 형태를 사용한 클래스 뿐만 아니라 커스텀 직렬화를 사용하더라도 모든 문제가 그대로 발생할 수 있다.
- 안전한 `readObject` 메서드를 작성하는 지침은 다음과 같다.
  - private이어야 하는 객체 참조 필드는 각 필드가 가리키는 객체를 방어적으로 복사하라. 불변 클래스 내의 가변 요소가 여기 속한다.
  - 모든 불변식을 검사하여 어긋나는 게 발견되면 `InvalidObjectException`을 던진다. 방어적 복사 다음에는 반드시 불변식 검사가 뒤따라야 한다.
  - 역직렬화 후 객체 그래프 전체의 유효성을 검사해야 한다면 `ObjectInputValidation` 인터페이스를 사용하라.
  - 직접적이든 간접적이든, 재정의할 수 있는 메서드는 호출하지 말자.