# 4. 역할, 책임, 협력

## 협력

### 요청하고 응답하며 협력하는 사람들

협력의 본질은 요청과 응답으로 연결되는 사람들의 네트워크이다. 문제는 혼자만의 힘으로는 해결하기 어렵기 때문에 해결 과정에 여러 사람이 참여하게 되고 이 과정 속에서 요청과 응답의 연쇄적인 흐름이 발생한다.

**협력**은 한 사람이 다른 사람에게 도움을 **요청**할 때 시작된다. 자신에게 할당된 일이나 업무를 처리하던 중에 스스로 해결하기 어려운 문제에 부딪히게 되면 문제를 해결하는 데 필요한 지식을 알고 있거나 도움을 받을 수 있는 누군가에게 도움을 준다.

결과적으로 **협력은 다수의 요청과 응답으로 구성되며 전체적으로 협력은 다수의 연쇄적인 요청과 응답의 흐름으로 구성된다.**

### 재판 속의 협력

- 누군가 왕에게 재판을 **요청**함으로써 재판이 시작된다.
- 왕이 하얀 토끼에게 증인을 부를 것을 **요청**한다.
- 왕의 요청을 받은 토끼는 모자 장수에게 증인석으로 입장할 것을 **요청**한다.
- 모자 장수는 증인석에 입장함으로써 토끼의 요청에 **응답**한다.
- 모자 장수의 입장은 왕이 토끼에게 요청했던 증인 호출에 대한 **응답**이기도 하다.
- 이제 왕은 모자 장수에게 증언할 것을 **요청**한다.
- 모자 장수는 자신이 알고 있는 내용을 증언함으로써 왕의 요청에 **응답**한다.

![KakaoTalk_Photo_2021-11-10-21-15-33](https://user-images.githubusercontent.com/60968342/141111396-f34b89fb-a360-4027-a3d4-e5435da596b3.jpeg)

**어떤 등장인물들이 특정한 요청을 받아들일 수 있는 이유는 그 요청에 대해 적절한 방식으로 응답하는 데 필요한 지식과 행동 방식을 가지고 있기 때문이다.**

## 책임

객체지향의 세계에서는 어떤 객체가 어떤 요청에 대해 대답해 줄 수 있거나, 적절한 행동을 할 의무가 있는 경우 해당 객체가 **책임**을 가진다고 말한다.

> "객체지향 개발에서 가장 중요한 능력은 책임을 능숙하게 소프트웨어 객체에 할당하는 것" - 크레이그 라만(Craig Larman)

### 책임의 분류

객체의 책임은 '객체가 무엇을 알고있는가(knowing)'와 '무엇을 할 수 있는가(doing)'로 구성된다.

#### 하는 것(doing)

- 객체를 생성하거나 계산을 하는 등의 스스로 하는 것
- 다른 객체의 행동을 시작시키는 것
- 다른 객체의 활동을 제어하고 조절하는 것

#### 아는 것(knowing)

- 개인적인 정보에 관해 아는 것
- 관련된 객체에 관해 아는 것
- 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

책임은 객체의 외부에 제공해 줄 수 있는 정보(아는 것의 측면)와 외부에 제공해 줄 수 있는 서비스(하는 것의 측면)의 목록이다. 따라서 책임은 객체의 **공용 인터페이스(public interface)**를 구성한다.

### 책임과 메시지

협력 안에서 객체는 다른 객체로부터 요청이 전송됐을 경우에만 자신에게 주어진 책임을 수행한다.

결국 한 객체가 다른 객체에게 전송된 요청은 그 요청을 수신할 객체의 책임이 수행되게 한다. 이처럼 객체가 다른 객체에게 주어진 책임을 수행하도록 요청을 보내는 것을 **메시지 전송(message-send)**이라고 한다. 따라서 두 객체간의 협력은 메시지를 통해 이뤄진다. 메시지는 협력을 위해 한 객체가 다른 객체로 접근할 수 있는 유일한 방법이다.

## 역할

### 책임의 집합이 의미하는 것

어떤 객체가 수행하는 책임의 집합은 객체가 협력 안에서 수행하는 역할을 암시한다. 역할은 재사용 가능하고 유연한 객체지향 설계를 낳는 매우 종요한 구성요소이다.

### 역할이 답이다

![KakaoTalk_Photo_2021-11-10-21-35-12](https://user-images.githubusercontent.com/60968342/141114083-d37941c0-c999-426c-b00a-668e9f88e65e.jpeg)

위 세 개의 협력에 참여하는 등장인물들을 제외한 나머지 과정들은 너무나 유사해서 하나의 협력으로 다룰 수 있다.

![KakaoTalk_Photo_2021-11-10-22-15-45](https://user-images.githubusercontent.com/60968342/141119822-aaf7546d-c2d5-4606-ad83-9f303c9557a7.jpeg)

// `스프링 핵심원리 - 기본편`에서 김영한 개발팀장님이 DI, IoC 개념을 설명하실 때 연극, 자동차 예시를 들어 설명하신 부분도 이 맥락과 같다.

**역할은 협력 내에서 다른 객체로 대체할 수 있음을 나타내는 일종의 표식이다.** 협력 안에서 역할은 "이 자리는 해당 역할을 수행할 수 있는 어떤 객체라도 대신할 수 있습니다"라고 말하는 것과 같다.

역할의 개념을 사용하면 유사한 협력을 추상화해서 인지 과부하를 줄일 수 있다. 또한 다양한 객체들이 협력에 참여할 수 있기 때문에 협력이 좀 더 유연해지며 다양한 객체들이 동일한 협력에 참여할 수 있기 때문에 재사용성이 높아진다. 역할은 객체지향 설계의 **단순성(simplicity), 유연성(flexibility), 재사용성(reusability)**을 뒷받침하는 핵심 개념이다.

### 협력과 추상화

역할의 가장 큰 가치는 하나의 협력 안에 여러 종류의 객체가 참여할 수 있게 함으로써 협력을 추상화할 수 있다는 것이다. 역할을 이용하면 협력을 추상화함으로써 단순화 할 수 있다. 구체적인 객체로 추상적인 역할을 대체해서 동일한 구조의 협력을 다양한 문맥에서 재사용할 수 있는 능력은 과거의 전통적인 패러다임과 구분되는 객체지향만의 힘이다.

### 대체 가능성

역할은 협력 안에서 구체적인 객체로 대체될 수 있는 추상적인 협력자다. 따라서 **본질적으로 역할은 다른 객체에 의해 대체 가능함을 의미한다.**

- 객체가 역할을 대체하기 위해서는 행동이 호환돼야 한다는 점에 주목하라.
- 객체가 역할에 주어진 책임 이외에 다른 책임을 수행할 수도 있다는 사실에 주목하라.
- 역할의 대체 가능성은 행위 호환성을 의미하고, 행위 호환성은 동일한 책임의 수행을 의미한다.

## 객체의 모양을 결정하는 협력

### 흔한 오류

1. 많은 사람들은 시스템에 필요한 데이터를 저장하기 위해 객체가 존재한다는 선입견을 가지고 있다.

   > 실제로 중요한 것은 객체의 행동, 즉 책임이다.

2. 두 번째 선입견은 객체지향이 클래스와 클래스 간의 관계를 표현하는 시스템의 정적인 측면에 중점을 둔다는 것이다.
   > 중요한 것은 협력에 참여하는 동적인 객체이며, 클래스는 단지 시스템에 필요한 객체를 표현하고 생성하기 위해 프로그래밍 언어가 제공하는 구현 메커니즘이다.

**객체지향의 핵심은 클래스를 어떻게 구현할 것인가가 아니라 객체가 협력 안에서 어떤 책임과 역할을 수행할 것인지를 결정하는 것이다.**

## 객체지향 설계 기법

- 책임-주도 설계(Responsibility-Driven Design)

  - UML, 클래스 먼저 설계하지 말자.
  - 협력에 참가하는 책임들을 분석하고 더 작은 책임으로 쪼개고 메시지를 만들자.
  - 그 후 객체를 정하자.
  - 자신을 책임질 수 있는 자율적인 객체가 나온다.(응집도가 높아진 객체)

- 디자인 패턴

  - 책임 주도 설계의 결과표
  - 반복적으로 발생하는 문제와 그 문제에 대한 해법의 쌍.
  - 패턴을 알고 있다면 바퀴를 반복적으로 발명할 필요가 없다.

- 테스트-주도 개발(Test-Driven Development)
  - 객체가 이미 존재한다고 가정하고 객체에게 어떤 메시지를 전송할 것인지에 관해 먼저 생각하라.
  - 단순히 테스트를 작성하기 위함이 아닌 책임을 수행할 객체 또는 클라이언트가 기대하는 객체의 역할이 메시지를 수신할 때 어떤 결과를 반환하고 그 과정에서 어떤 객체와 협력할 것인지에 대한 기대를 코드의 형태로 작성하는 것이다.
