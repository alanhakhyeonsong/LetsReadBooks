# 4장. 테스트 구축하기
- 리팩터링을 제대로 하려면 불가피하게 저지르는 실수를 잡아주는 견고한 test suite가 뒷받침돼야 한다.
- 리팩터링을 하지 않더라도 좋은 테스트를 작성하는 일은 개발 효율을 높여준다.

## 자가 테스트 코드의 가치
- 사실 실제로 코드를 작성하는 시간의 비중은 그리 크지 않다. 현재 상황을 파악하기도 하고, 설계를 고민하기도 하며 대부분의 시간은 디버깅에 쓴다.
- 버그 수정 자체는 대체로 금방 끝난다. 버그를 찾는 여정이 끔찍하다.
- 테스트 코드는 이런 시간을 대폭 줄여준다.
- 모든 테스트를 완전히 자동화하고 그 결과까지 스스로 검사하게 만들자.
- 다만, 테스트를 작성하려면 소프트웨어 제품 본체 외의 부가적인 코드를 상당량 작성해야 한다. 하지만 자동화한다면 꽤 효과가 좋다.
- 테스트를 작성하기 가장 좋은 시점은 프로그래밍을 시작하기 전이다.
  - 기능을 추가할 때 테스트부터 작성한다. → 구현보다 인터페이스에 집중한다. → 코딩이 완료되는 시점을 정확하게 판단할 수 있다.

## 테스트할 샘플 코드

```
지역: Asia

수요: 30, 가격: 20

생산자 수: 3

Byzantium: 비용: 10, 생산량: 9, 수익: 90

Attalia: 비용: 12, 생산량: 10, 수익: 120

Sinope: 비용: 10, 생산량: 6, 수익: 60

부족분: 5, 총수익: 230
```

- 생산 계획은 각 지역 (province) 의 수요 (demand) 와 가격 (price) 으로 구성된다.
- 지역에 위치한 생산자들은 각기 제품을 특정 가격으로 특정 수량만큼 생산할 수 있다.
- 이 텍스트는 생산자별로 제품을 모두 판매했을 때 얻을 수 있는 수익 (full revenue) 를 보여준다.
- 부족분 (shortfall)은 수요에서 총 생산량을 뺸 값이고 여기서는 총수익 (profit) 도 볼 수 있다.
- 사용자는 여기서 수요, 가격, 생산량 (production) 비용 (cost) 를 조정해가며, 그에 따른 생산 부족분과 총수익을 확인할 수 있다.

여기서는 이 소프트웨어의 핵심 비즈니스 로직을 살펴보는데 집중하자. 이 소프트웨어의 전반적인 기능은 다음과 같다.
- 수익과 생산 부족성을 계산할 수 있어야 한다.

비즈니스 로직 클래스는 크게 두 가지로 구성된다. 지역을 나타내는 `Province`와 생산자인 `Producer`이다.


